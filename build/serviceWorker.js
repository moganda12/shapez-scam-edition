const CACHE_NAME = "Shapez-se-v04"

self.addEventListener('install', event => {
    event.waitUntil((async () => {

        const cache = await caches.open(CACHE_NAME);

        cache.addAll([
            '/',
            '/index.html',
            '/bundle.js',
            '/main.css',
            '/favicon.ico',
            '/res/fonts/GameFont.woff2',
            '/res/sounds/music/menu.mp3',
            '/res/sounds/music/puzzle-full.mp3',
            '/res/sounds/music/theme-full.mp3',
            '/res/sounds/sfx.mp3',
            '/res/ui/building_icons/analyzer.png',
            '/res/ui/building_icons/balancer.png',
            '/res/ui/building_icons/belt.png',
            '/res/ui/building_icons/block.png',
            '/res/ui/building_icons/comparator.png',
            '/res/ui/building_icons/constant_producer.png',
            '/res/ui/building_icons/constant_signal.png',
            '/res/ui/building_icons/cutter.png',
            '/res/ui/building_icons/display.png',
            '/res/ui/building_icons/filter.png',
            '/res/ui/building_icons/goal_acceptor.png',
            '/res/ui/building_icons/item_producer.png',
            '/res/ui/building_icons/lever.png',
            '/res/ui/building_icons/logic_gate.png',
            '/res/ui/building_icons/miner.png',
            '/res/ui/building_icons/mixer.png',
            '/res/ui/building_icons/painter.png',
            '/res/ui/building_icons/reader.png',
            '/res/ui/building_icons/rotater.png',
            '/res/ui/building_icons/stacker.png',
            '/res/ui/building_icons/storage.png',
            '/res/ui/building_icons/transistor.png',
            '/res/ui/building_icons/trash.png',
            '/res/ui/building_icons/underground_belt.png',
            '/res/ui/building_icons/virtual_processor.png',
            '/res/ui/building_icons/wire.png',
            '/res/ui/building_icons/wire_tunnel.png',
            '/res/ui/building_tutorials/analyzer.png',
            '/res/ui/building_tutorials/balancer-merger.png',
            '/res/ui/building_tutorials/balancer-splitter.png',
            '/res/ui/building_tutorials/balancer.png',
            '/res/ui/building_tutorials/belt.png',
            '/res/ui/building_tutorials/block.png',
            '/res/ui/building_tutorials/comparator.png',
            '/res/ui/building_tutorials/constant_producer.png',
            '/res/ui/building_tutorials/constant_signal.png',
            '/res/ui/building_tutorials/cutter-quad.png',
            '/res/ui/building_tutorials/cutter.png',
            '/res/ui/building_tutorials/display.png',
            '/res/ui/building_tutorials/display.png',
            '/res/ui/building_tutorials/goal_acceptor.png',
            '/res/ui/building_tutorials/item_producer.png',
            '/res/ui/building_tutorials/lever.png',
            '/res/ui/building_tutorials/logic_gate-and.png',
            '/res/ui/building_tutorials/logic_gate-not.png',
            '/res/ui/building_tutorials/logic_gate-or.png',
            '/res/ui/building_tutorials/logic_gate-xor.png',
            '/res/ui/building_tutorials/miner-chainable.png',
            '/res/ui/building_tutorials/miner.png',
            '/res/ui/building_tutorials/mixer.png',
            '/res/ui/building_tutorials/painter-double.png',
            '/res/ui/building_tutorials/painter-mirrored.png',
            '/res/ui/building_tutorials/painter-quad.png',
            '/res/ui/building_tutorials/painter.png',
            '/res/ui/building_tutorials/reader.png',
            '/res/ui/building_tutorials/rotater-ccw.png',
            '/res/ui/building_tutorials/rotater-rotate180.png',
            '/res/ui/building_tutorials/rotater.png',
            '/res/ui/building_tutorials/stacker.png',
            '/res/ui/building_tutorials/storage.png',
            '/res/ui/building_tutorials/transistor.png',
            '/res/ui/building_tutorials/trash.png',
            '/res/ui/building_tutorials/underground_belt-tier2.png',
            '/res/ui/building_tutorials/underground_belt.png',
            '/res/ui/building_tutorials/virtual_processor-cutter.png',
            '/res/ui/building_tutorials/virtual_processor-painter.png',
            '/res/ui/building_tutorials/virtual_processor-rotater.png',
            '/res/ui/building_tutorials/virtual_processor-stacker.png',
            '/res/ui/building_tutorials/virtual_processor-unstacker.png',
            '/res/ui/building_tutorials/wire-second.png',
            '/res/ui/building_tutorials/wire.png',
            '/res/ui/building_tutorials/wire_tunnel.png',
            '/res/ui/icons/advantage_achievements.png',
            '/res/ui/icons/advantage_buildings.png',
            '/res/ui/icons/advantage_markers.png',
            '/res/ui/icons/advantage_mods.png',
            '/res/ui/icons/advantage_new_levels.png',
            '/res/ui/icons/advantage_savegames.png',
            '/res/ui/icons/advantage_support.png',
            '/res/ui/icons/advantage_upgrades.png',
            '/res/ui/icons/advantage_wires.png',
            '/res/ui/icons/blueprint_marker.png',
            '/res/ui/icons/blueprint_marker_inverted.png',
            '/res/ui/icons/close.png',
            '/res/ui/icons/current_goal_marker.png',
            '/res/ui/icons/current_goal_marker_inverted.png',
            '/res/ui/icons/delete.png',
            '/res/ui/icons/demo_steam_link_indicator.png',
            '/res/ui/icons/display_icons.png',
            '/res/ui/icons/display_list.png',
            '/res/ui/icons/display_sorted.png',
            '/res/ui/icons/download.png',
            '/res/ui/icons/edit_key.png',
            '/res/ui/icons/enum_selector.png',
            '/res/ui/icons/enum_selector_white.png',
            '/res/ui/icons/help.png',
            '/res/ui/icons/info_button.png',
            '/res/ui/icons/link.png',
            '/res/ui/icons/main_menu_exit.png',
            '/res/ui/icons/main_menu_settings.png',
            '/res/ui/icons/mods.png',
            '/res/ui/icons/mods_white.png',
            '/res/ui/icons/mouse_left.png',
            '/res/ui/icons/mouse_right.png',
            '/res/ui/icons/music_off.png',
            '/res/ui/icons/music_on.png',
            '/res/ui/icons/notification_error.png',
            '/res/ui/icons/notification_info.png',
            '/res/ui/icons/notification_saved.png',
            '/res/ui/icons/notification_success.png',
            '/res/ui/icons/notification_upgrade.png',
            '/res/ui/icons/notification_warning.png',
            '/res/ui/icons/pin.png',
            '/res/ui/icons/play.png',
            '/res/ui/icons/puzzle_action_liked_no.png',
            '/res/ui/icons/puzzle_action_liked_yes.png',
            '/res/ui/icons/puzzle_complete_indicator.png',
            '/res/ui/icons/puzzle_complete_indicator_inverse.png',
            '/res/ui/icons/puzzle_completion_rate.png',
            '/res/ui/icons/puzzle_plays.png',
            '/res/ui/icons/puzzle_upvotes.png',
            '/res/ui/icons/reset_key.png',
            '/res/ui/icons/save.png',
            '/res/ui/icons/settings.png',
            '/res/ui/icons/settings_menu_exit.png',
            '/res/ui/icons/settings_menu_play.png',
            '/res/ui/icons/settings_menu_settings.png',
            '/res/ui/icons/shop.png',
            '/res/ui/icons/shop_active.png',
            '/res/ui/icons/sound_off.png',
            '/res/ui/icons/sound_on.png',
            '/res/ui/icons/state_back_button.png',
            '/res/ui/icons/state_next_button.png',
            '/res/ui/icons/statistics.png',
            '/res/ui/icons/toggle_unit.png',
            '/res/ui/icons/tutorial_arrow.png',
            '/res/ui/icons/unpin.png',
            '/res/ui/icons/unpin_shape.png',
            '/res/ui/icons/waypoint.png',
            '/res/ui/icons/waypoint_wires.png',
            '/res/ui/interactive_tutorial.cn.noinline/1_1_extractor.gif',
            '/res/ui/interactive_tutorial.cn.noinline/1_2_conveyor.gif',
            '/res/ui/interactive_tutorial.cn.noinline/1_3_expand.gif',
            '/res/ui/interactive_tutorial.cn.noinline/21_1_place_quad_painter.gif',
            '/res/ui/interactive_tutorial.cn.noinline/21_2_switch_to_wires.gif',
            '/res/ui/interactive_tutorial.cn.noinline/21_3_place_button.gif',
            '/res/ui/interactive_tutorial.cn.noinline/21_4_press_button.gif',
            '/res/ui/interactive_tutorial.cn.noinline/2_1_place_cutter.gif',
            '/res/ui/interactive_tutorial.cn.noinline/2_2_place_trash.gif',
            '/res/ui/interactive_tutorial.cn.noinline/2_3_more_cutters.gif',
            '/res/ui/interactive_tutorial.cn.noinline/3_1_rectangles.gif',
            '/res/ui/interactive_tutorial.noinline/1_1_extractor.gif',
            '/res/ui/interactive_tutorial.noinline/1_2_conveyor.gif',
            '/res/ui/interactive_tutorial.noinline/1_3_expand.gif',
            '/res/ui/interactive_tutorial.noinline/21_1_place_quad_painter.gif',
            '/res/ui/interactive_tutorial.noinline/21_2_switch_to_wires.gif',
            '/res/ui/interactive_tutorial.noinline/21_3_place_button.gif',
            '/res/ui/interactive_tutorial.noinline/21_4_press_button.gif',
            '/res/ui/interactive_tutorial.noinline/2_1_place_cutter.gif',
            '/res/ui/interactive_tutorial.noinline/2_2_place_trash.gif',
            '/res/ui/interactive_tutorial.noinline/2_3_more_cutters.gif',
            '/res/ui/interactive_tutorial.noinline/3_1_rectangles.gif',
            '/res/ui/languages/ar.svg',
            '/res/ui/languages/cs.svg',
            '/res/ui/languages/da.svg',
            '/res/ui/languages/de.svg',
            '/res/ui/languages/el.svg',
            '/res/ui/languages/en.svg',
            '/res/ui/languages/es-419.svg',
            '/res/ui/languages/et.svg',
            '/res/ui/languages/fi.svg',
            '/res/ui/languages/fr.svg',
            '/res/ui/languages/he.svg',
            '/res/ui/languages/hu.svg',
            '/res/ui/languages/it.svg',
            '/res/ui/languages/ja.svg',
            '/res/ui/languages/kor.svg',
            '/res/ui/languages/mt-MT.svg',
            '/res/ui/languages/nb.svg',
            '/res/ui/languages/nl.svg',
            '/res/ui/languages/no.svg',
            '/res/ui/languages/pl.svg',
            '/res/ui/languages/pt-BR.svg',
            '/res/ui/languages/pt-PT.svg',
            '/res/ui/languages/ro.svg',
            '/res/ui/languages/ru.svg',
            '/res/ui/languages/sv.svg',
            '/res/ui/languages/th.svg',
            '/res/ui/languages/tr.svg',
            '/res/ui/languages/uk.svg',
            '/res/ui/languages/vi.svg',
            '/res/ui/languages/zh-CN.svg',
            '/res/ui/languages/zh-TW.svg',
            '/res/ui/main_menu/bg_pattern.png',
            '/res/ui/main_menu/changelog.svg',
            '/res/ui/main_menu/discord.svg',
            '/res/ui/main_menu/github.png',
            '/res/ui/main_menu/github.svg',
            '/res/ui/main_menu/opensea.png',
            '/res/ui/main_menu/patreon.svg',
            '/res/ui/main_menu/reddit.svg',
            '/res/ui/main_menu/steam.svg',
            '/res/ui/main_menu/translate.svg',
            '/res/ui/main_menu/twitter.svg',
            '/res/ui/memes/cat1.png',
            '/res/ui/steam_link_btn/0.png',
            '/res/ui/cursor.png',
            '/res/ui/demo_badge.png',
            '/res/ui/dialog_bg_pattern.png',
            '/res/ui/get_on_itch_io.svg',
            '/res/ui/kiwi_clicker.png',
            '/res/ui/loading.svg',
            '/res/ui/locked_building.png',
            '/res/ui/puzzle_460x215_15.png',
            '/res/ui/puzzle_dlc_logo.png',
            '/res/ui/puzzle_dlc_logo_china.png',
            '/res/ui/puzzle_dlc_logo_inverse.png',
            '/res/ui/sad_ghost.png',
            '/res/ui/shapez2.png',
            '/res/ui/steam_signin.png',
            '/res/ui/toolbar_bg.lossless.png',
            '/res/ui/vignette-strong.lossless.png',
            '/res/ui/vignette.lossless.png',
            '/res/ui/wegame_isbn_rating.jpg',
            '/res/atlas0_hq.png',
            '/res/atlas0_lq.png',
            '/res/atlas0_mq.png',
            '/res/bg_render.webm',
            '/res/logo-tobspr-games.svg',
            '/res/logo.png',
            '/res/logo_cn.png',
            '/res/logo_demo.png',
            '/res/logo_wegame.png',
            '/res/puzzle_dlc_logo.png',
            '/res/puzzle_dlc_logo_china.png',
            '/async-resources.css',
            '/logo.webp'
        ]);
    })());
});

self.addEventListener('fetch', event => {
    event.respondWith((async () => {
        const cache = await caches.open(CACHE_NAME);

        const cachedResponse = await cache.match(event.request);
        if (cachedResponse) {
            return cachedResponse;
        } else {
            try {
                const fetchResponse = await fetch(event.request);

                cache.put(event.request, fetchResponse.clone());
                return fetchResponse;
            } catch (e) {
                //fail
            }
        }
    })());
});
